<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; filibuster  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Filibuster" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> filibuster
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-flask-apps">Creating your Flask Apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flask-app-setup">Flask App Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#filibuster-tutorial-networking-json"><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/networking.json</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#filibuster-tutorial-makefile"><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/Makefile</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-baz-app">Creating the <code class="docutils literal notranslate"><span class="pre">baz</span></code> App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-bar-app">Creating the <code class="docutils literal notranslate"><span class="pre">bar</span></code> App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-foo-app">Creating the <code class="docutils literal notranslate"><span class="pre">foo</span></code> App</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functional-testing">Functional Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finding-the-bug">Finding the Bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fixing-the-bug">Fixing the Bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-fix">Testing the Fix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integrating-docker">Integrating Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integrating-minikube">Integrating Minikube</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="coverage.html">Coverage Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-status.html">Build Status</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Filibuster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-overview.html">Instrumentation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-flask.html">Instrumentation Example: Flask</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-requests.html">Instrumentation Example: Requests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Instrumentation: GRPC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-overview.html">Instrumenting GRPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client.html">Instrumenting Remote Service Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-server.html">Instrumenting Services To Receive Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client-fi.html">Enabling Fault-Injection in the Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client-analysis.html">Static Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Instrumentation: Java</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-java-overview.html">Java Instrumentors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Filibuster Server API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-formats.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-create.html">HTTP API: Create</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-update.html">HTTP API: Update</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-new-test-execution.html">HTTP API: New Test Execution</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">filibuster</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline"></a></h1>
<p>This tutorial contains step-by-step instructions for debugging a local application using <code class="docutils literal notranslate"><span class="pre">filibuster</span></code>. In this tutorial, you will:</p>
<ol class="arabic simple">
<li><p>Create three Flask apps that work together to respond “foo bar baz” to a client (this contains a bug)</p></li>
<li><p>Write functional tests for your Flask apps</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> to find the bug</p></li>
<li><p>Fix the bug and verify fault tolerance with <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> locally and via Docker and Minikube</p></li>
</ol>
<p>Please note that this tutorial assumes <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> is already in the namespace.</p>
<section id="creating-your-flask-apps">
<h2>Creating your Flask Apps<a class="headerlink" href="#creating-your-flask-apps" title="Permalink to this headline"></a></h2>
<section id="flask-app-setup">
<h3>Flask App Setup<a class="headerlink" href="#flask-app-setup" title="Permalink to this headline"></a></h3>
<p>Navigate to <code class="docutils literal notranslate"><span class="pre">nufilibuster/examples</span></code>. Create the basic structure for your apps:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir filibuster-tutorial <span class="c1"># This is where you&#39;ll be putting all files for this tutorial.</span>
mkdir filibuster-tutorial/services <span class="c1"># This is where you will write your apps.</span>
mkdir filibuster-tutorial/functional
touch filibuster-tutorial/functional/test_foo_bar_baz.py <span class="c1"># This is where you will write the functional test for your apps.</span>
touch filibuster-tutorial/networking.json <span class="c1"># This is where you will write networking information for your apps.</span>
touch filibuster-tutorial/Makefile <span class="c1"># This is where you will write the Makefile for your apps.</span>
</pre></div>
</div>
<section id="filibuster-tutorial-networking-json">
<h4><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/networking.json</span></code><a class="headerlink" href="#filibuster-tutorial-networking-json" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/networking.json</span></code> allows you to specify networking information including ports, hosts, and timeout lengths
for your apps. <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> uses this networking information to make requests to each of your services. Note that
<code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/networking.json</span></code> specifies both a <code class="docutils literal notranslate"><span class="pre">docker-host</span></code> and <code class="docutils literal notranslate"><span class="pre">default-host</span></code> for each service. Since <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> can
run locally, via Docker, and via Minikube, we need to provide different host names to accomodate the different environments
<code class="docutils literal notranslate"><span class="pre">filibuster</span></code> is ran in. <code class="docutils literal notranslate"><span class="pre">docker-host</span></code> should always be the name of your service.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/networking.json</span></code>, add networking
information for each of our three services (<code class="docutils literal notranslate"><span class="pre">foo</span></code>, <code class="docutils literal notranslate"><span class="pre">bar</span></code>, and <code class="docutils literal notranslate"><span class="pre">baz</span></code>) and <code class="docutils literal notranslate"><span class="pre">filibuster</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;foo&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="mi">5000</span><span class="p">,</span>
      <span class="s2">&quot;docker-host&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;default-host&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timeout-seconds&quot;</span><span class="o">:</span> <span class="mi">6</span>
    <span class="p">},</span>
    <span class="s2">&quot;bar&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="mi">5001</span><span class="p">,</span>
      <span class="s2">&quot;docker-host&quot;</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
      <span class="s2">&quot;default-host&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timeout-seconds&quot;</span><span class="o">:</span> <span class="mi">6</span>
    <span class="p">},</span>
    <span class="s2">&quot;baz&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="mi">5002</span><span class="p">,</span>
      <span class="s2">&quot;docker-host&quot;</span><span class="o">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span>
      <span class="s2">&quot;default-host&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timeout-seconds&quot;</span><span class="o">:</span> <span class="mi">6</span>
    <span class="p">},</span>
    <span class="s2">&quot;filibuster&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="mi">5005</span><span class="p">,</span>
      <span class="s2">&quot;docker-host&quot;</span><span class="o">:</span> <span class="s2">&quot;filibuster&quot;</span><span class="p">,</span>
      <span class="s2">&quot;default-host&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timeout-seconds&quot;</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="filibuster-tutorial-makefile">
<h4><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/Makefile</span></code><a class="headerlink" href="#filibuster-tutorial-makefile" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/Makefile</span></code> specifies <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">targets</span></code> for building and running your apps using <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> locally, via Docker, and via Minikube.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/Makefile</span></code>, add the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">PHONY</span><span class="o">:</span> <span class="nx">reqs</span> <span class="nx">unit</span> <span class="nx">functional</span>

<span class="nx">example</span> <span class="o">=</span> <span class="nx">filibuster</span><span class="o">-</span><span class="nx">tutorial</span>
<span class="nx">services</span> <span class="o">=</span> <span class="nx">foo</span> <span class="nx">bar</span> <span class="nx">baz</span>
<span class="nx">ports</span> <span class="o">=</span> <span class="mi">5000</span> <span class="mi">5001</span> <span class="mi">5002</span>
<span class="nx">filibuster</span><span class="o">-</span><span class="nx">port</span> <span class="o">=</span> <span class="mi">5005</span>

<span class="nx">include</span> <span class="p">..</span><span class="o">/</span><span class="nx">shared_build_examples</span><span class="p">.</span><span class="nx">mk</span>
</pre></div>
</div>
<p>Then create the files you will be working with for this tutorial. These files will specify the three different Flask apps needed
to respond “foo bar baz” to a client. These files include <code class="docutils literal notranslate"><span class="pre">python</span></code> files as well as the infrastructure needed to run the apps
using <code class="docutils literal notranslate"><span class="pre">filibuster</span></code>. Run the following:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through the three services that we want to create (and their associated ports) and create initial file structure.</span>
<span class="c1"># Note the services and corresponding ports correspond to filibuster-tutorial/networking.json</span>
<span class="k">for</span> i in <span class="s2">&quot;foo 5000&quot;</span> <span class="s2">&quot;bar 5001&quot;</span> <span class="s2">&quot;baz 5002&quot;</span>
<span class="k">do</span>
    <span class="nb">set</span> -- <span class="nv">$i</span>
    <span class="nv">service</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">port</span><span class="o">=</span><span class="nv">$2</span>

    mkdir -p <span class="s2">&quot;filibuster-tutorial/services/</span><span class="nv">$service</span><span class="s2">/</span><span class="nv">$service</span><span class="s2">&quot;</span>
    touch <span class="s2">&quot;filibuster-tutorial/services/</span><span class="nv">$service</span><span class="s2">/</span><span class="nv">$service</span><span class="s2">/__init__.py&quot;</span>
    touch <span class="s2">&quot;filibuster-tutorial/services/</span><span class="nv">$service</span><span class="s2">/</span><span class="nv">$service</span><span class="s2">/app.py&quot;</span> <span class="c1"># This is where you will write the Flask functionality.</span>

    <span class="c1"># Each service must have a Makefile specifying information for filibuster.</span>
    <span class="nv">makefile</span><span class="o">=</span><span class="s2">&quot;APP=filibuster-tutorial\nSERVICE=</span><span class="nv">$service</span><span class="s2">\nPORT=</span><span class="nv">$port</span><span class="s2">\n\n.PHONY: test reqs\n\ninclude ../../../shared_build_services.mk&quot;</span>
    <span class="nb">echo</span> -e <span class="nv">$makefile</span> &gt;&gt; filibuster-tutorial/services/<span class="nv">$service</span>/Makefile <span class="c1"># Specify information about the service, used by filibuster.</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-the-baz-app">
<h3>Creating the <code class="docutils literal notranslate"><span class="pre">baz</span></code> App<a class="headerlink" href="#creating-the-baz-app" title="Permalink to this headline"></a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/service/baz/baz/app.py</span></code>, add the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">ServiceUnavailable</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">examples_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">helper</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">Helper</span><span class="p">(</span><span class="s2">&quot;filibuster-tutorial&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Start OpenTelemetry Configuration</span>

<span class="kn">from</span> <span class="nn">opentelemetry</span> <span class="kn">import</span> <span class="n">trace</span>
<span class="kn">from</span> <span class="nn">opentelemetry.exporter</span> <span class="kn">import</span> <span class="n">jaeger</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace</span> <span class="kn">import</span> <span class="n">TracerProvider</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace.export</span> <span class="kn">import</span> <span class="n">BatchExportSpanProcessor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span>

<span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>

<span class="n">jaeger_exporter</span> <span class="o">=</span> <span class="n">jaeger</span><span class="o">.</span><span class="n">JaegerSpanExporter</span><span class="p">(</span>
    <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span>
    <span class="n">agent_host_name</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_host_name</span><span class="p">(),</span>
    <span class="n">agent_port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_port</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span>
    <span class="n">BatchExportSpanProcessor</span><span class="p">(</span><span class="n">jaeger_exporter</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Instrument using filibuster</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">examples_path</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">filibuster.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterRequestsInstrumentor</span>

<span class="n">FilibusterRequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">filibuster.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterFlaskInstrumentor</span>

<span class="n">FilibusterFlaskInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="n">RequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>

<span class="c1"># filibuster requires a health check app to ensure service is running</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/health-check&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">baz_health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span> <span class="p">})</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/baz&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;baz&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_port</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">),</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_debug</span><span class="p">())</span>
</pre></div>
</div>
<p>Note the instrumentation code under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Instrument</span> <span class="pre">using</span> <span class="pre">filibuster</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">filibuster.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterRequestsInstrumentor</span>

<span class="n">FilibusterRequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">filibuster.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterFlaskInstrumentor</span>

<span class="n">FilibusterFlaskInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="n">RequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>
</pre></div>
</div>
<p>Each service you create will need to include this code, with <code class="docutils literal notranslate"><span class="pre">service_name</span></code> updated accordingly. This instrumentation
code allows <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> to instrument Flask and Requests, which in turn allows <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> to compute and test
different faults.</p>
</section>
<section id="creating-the-bar-app">
<h3>Creating the <code class="docutils literal notranslate"><span class="pre">bar</span></code> App<a class="headerlink" href="#creating-the-bar-app" title="Permalink to this headline"></a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/service/bar/bar/app.py</span></code>, add the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">ServiceUnavailable</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">examples_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">helper</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">Helper</span><span class="p">(</span><span class="s2">&quot;filibuster-tutorial&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Start OpenTelemetry Configuration</span>

<span class="kn">from</span> <span class="nn">opentelemetry</span> <span class="kn">import</span> <span class="n">trace</span>
<span class="kn">from</span> <span class="nn">opentelemetry.exporter</span> <span class="kn">import</span> <span class="n">jaeger</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace</span> <span class="kn">import</span> <span class="n">TracerProvider</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace.export</span> <span class="kn">import</span> <span class="n">BatchExportSpanProcessor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span>

<span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>

<span class="n">jaeger_exporter</span> <span class="o">=</span> <span class="n">jaeger</span><span class="o">.</span><span class="n">JaegerSpanExporter</span><span class="p">(</span>
    <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="n">agent_host_name</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_host_name</span><span class="p">(),</span>
    <span class="n">agent_port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_port</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span>
    <span class="n">BatchExportSpanProcessor</span><span class="p">(</span><span class="n">jaeger_exporter</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Instrument using filibuster</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">examples_path</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">filibuster.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterRequestsInstrumentor</span>

<span class="n">FilibusterRequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">filibuster.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterFlaskInstrumentor</span>

<span class="n">FilibusterFlaskInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="n">RequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>


<span class="c1"># filibuster requires a health check app to ensure service is running</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/health-check&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bar_health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span> <span class="p">})</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/bar/baz&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;{}/baz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">)),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_timeout</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The baz service is unavailable.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The baz service timed out.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The baz service is malfunctioning.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;bar &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_port</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">),</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_debug</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="creating-the-foo-app">
<h3>Creating the <code class="docutils literal notranslate"><span class="pre">foo</span></code> App<a class="headerlink" href="#creating-the-foo-app" title="Permalink to this headline"></a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/service/foo/foo/app.py</span></code>, add the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">ServiceUnavailable</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">examples_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">helper</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">Helper</span><span class="p">(</span><span class="s2">&quot;filibuster-tutorial&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Start OpenTelemetry Configuration</span>

<span class="kn">from</span> <span class="nn">opentelemetry</span> <span class="kn">import</span> <span class="n">trace</span>
<span class="kn">from</span> <span class="nn">opentelemetry.exporter</span> <span class="kn">import</span> <span class="n">jaeger</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace</span> <span class="kn">import</span> <span class="n">TracerProvider</span>
<span class="kn">from</span> <span class="nn">opentelemetry.sdk.trace.export</span> <span class="kn">import</span> <span class="n">BatchExportSpanProcessor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span>
<span class="kn">from</span> <span class="nn">opentelemetry.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span>

<span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>

<span class="n">jaeger_exporter</span> <span class="o">=</span> <span class="n">jaeger</span><span class="o">.</span><span class="n">JaegerSpanExporter</span><span class="p">(</span>
    <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
    <span class="n">agent_host_name</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_host_name</span><span class="p">(),</span>
    <span class="n">agent_port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">jaeger_agent_port</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span>
    <span class="n">BatchExportSpanProcessor</span><span class="p">(</span><span class="n">jaeger_exporter</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">## Instrument using filibuster</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">examples_path</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">filibuster.instrumentation.requests</span> <span class="kn">import</span> <span class="n">RequestsInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterRequestsInstrumentor</span>

<span class="n">FilibusterRequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">filibuster.instrumentation.flask</span> <span class="kn">import</span> <span class="n">FlaskInstrumentor</span> <span class="k">as</span> <span class="n">FilibusterFlaskInstrumentor</span>

<span class="n">FilibusterFlaskInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                                            <span class="n">filibuster_url</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;filibuster&#39;</span><span class="p">))</span>

<span class="n">RequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>

<span class="c1"># filibuster requires a health check app to ensure service is running</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/health-check&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">foo_health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span> <span class="p">})</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/foo/bar/baz&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;{}/bar/baz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_timeout</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The bar service timed out.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The bar service is malfunctioning.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;foo &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_port</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_debug</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
<section id="functional-testing">
<h2>Functional Testing<a class="headerlink" href="#functional-testing" title="Permalink to this headline"></a></h2>
<p>Now that your Flask apps are created, write a functional test. This test will ensure that our three apps work
together to return “foo bar baz” to a client. In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/functional/test_foo_bar_baz.py</span></code>, add
the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">examples_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">helper</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">Helper</span><span class="p">(</span><span class="s2">&quot;filibuster-tutorial&quot;</span><span class="p">)</span>

<span class="c1"># Note that tests should be prefixed with test_functional for filibuster compatibility</span>
<span class="k">def</span> <span class="nf">test_functional_foo_bar_baz</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;{}/foo/bar/baz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_timeout</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;foo bar baz&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_functional_foo_bar_baz</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, verify that the functional test passes:</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">make</span> <span class="pre">local-functional-via-filibuster-server</span></code></p>
<p>You should get something like the following output:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>NOTICE<span class="o">]</span>: Running <span class="nb">test</span> test_functional_foo_bar_baz
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Running initial non-failing execution <span class="o">(</span><span class="nb">test</span> <span class="m">1</span><span class="o">)</span> <span class="p">&amp;</span>ltmodule <span class="s1">&#39;test_foo_bar_baz&#39;</span> from <span class="s1">&#39;/Users/filibuster-user/nufilibuster/examples/filibuster-tutorial/functional/test_foo_bar_baz.py&#39;</span><span class="p">&amp;</span>gt
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">[</span>DONE<span class="o">]</span> Running initial non-failing execution <span class="o">(</span><span class="nb">test</span> <span class="m">1</span><span class="o">)</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>NOTICE<span class="o">]</span>: Completed testing test_functional_foo_bar_baz
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually ran:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: None.
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually pruned:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: None.
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of tests attempted: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of <span class="nb">test</span> executions ran: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions pruned with only dynamic pruning: <span class="m">0</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Total tests: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Time elapsed: <span class="m">0</span>.134443998336792 seconds.
</pre></div>
</div>
</section>
<section id="finding-the-bug">
<h2>Finding the Bug<a class="headerlink" href="#finding-the-bug" title="Permalink to this headline"></a></h2>
<p>Now, we will use <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> to inject faults.</p>
<p>First we need to update our test a bit. Instead of only ensuring that our three apps successfully return “foo bar baz” to a client,
we also want to allow the request to <code class="docutils literal notranslate"><span class="pre">foo</span></code> to fail gracefully. To ensure the request fails only when it should, we should use the
<code class="docutils literal notranslate"><span class="pre">helper</span></code> module. <code class="docutils literal notranslate"><span class="pre">helper</span></code>’s <code class="docutils literal notranslate"><span class="pre">fault_injected()</span></code> tells us whether:</p>
<ul class="simple">
<li><p>a fault has been injected, meaning <code class="docutils literal notranslate"><span class="pre">response.status_code</span></code> should be a failure status code</p></li>
<li><p>or not, meaning <code class="docutils literal notranslate"><span class="pre">response.status_code</span></code> should be <code class="docutils literal notranslate"><span class="pre">200</span></code> and “foo bar baz” should be returned</p></li>
</ul>
<p>Adjust <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/functional/test_foo_bar_baz.py</span></code> to incorporate <code class="docutils literal notranslate"><span class="pre">helper</span></code>’s <code class="docutils literal notranslate"><span class="pre">fault_injected()</span></code> so that it matches the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">examples_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">examples_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">helper</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">Helper</span><span class="p">(</span><span class="s2">&quot;filibuster-tutorial&quot;</span><span class="p">)</span>

<span class="c1"># Note that tests should be prefixed with test_functional for filibuster compatibility</span>
<span class="k">def</span> <span class="nf">test_functional_foo_bar_baz</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;{}/foo/bar/baz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">get_service_url</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">get_timeout</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="n">helper</span><span class="o">.</span><span class="n">fault_injected</span><span class="p">())</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;foo bar baz&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">helper</span><span class="o">.</span><span class="n">fault_injected</span><span class="p">()</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">503</span><span class="p">,</span> <span class="mi">404</span><span class="p">]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_functional_foo_bar_baz</span><span class="p">()</span>
</pre></div>
</div>
<p>Run the following:</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">make</span> <span class="pre">local-functional-with-fault-injection-bypass-stop-start</span></code></p>
<p>You should get the following output:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">8</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">18</span>/May/2021 <span class="m">17</span>:02:25<span class="o">]</span> <span class="s2">&quot;GET /filibuster/new-test-execution/foo HTTP/1.1&quot;</span> <span class="m">200</span> -
<span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">18</span>/May/2021 <span class="m">17</span>:02:25<span class="o">]</span> <span class="s2">&quot;PUT /filibuster/create HTTP/1.1&quot;</span> <span class="m">200</span> -
<span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">18</span>/May/2021 <span class="m">17</span>:02:25<span class="o">]</span> <span class="s2">&quot;POST /filibuster/update HTTP/1.1&quot;</span> <span class="m">200</span> -
<span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">18</span>/May/2021 <span class="m">17</span>:02:25<span class="o">]</span> <span class="s2">&quot;POST /filibuster/update HTTP/1.1&quot;</span> <span class="m">200</span> -
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/filibuster-user/nufilibuster/examples/filibuster-tutorial/functional/test_foo_bar_baz.py&quot;</span>, line <span class="m">20</span>, in &lt;module&gt;
    test_functional_foo_bar_baz<span class="o">()</span>
  File <span class="s2">&quot;/Users/filibuster-user/nufilibuster/examples/filibuster-tutorial/functional/test_foo_bar_baz.py&quot;</span>, line <span class="m">17</span>, in test_functional_foo_bar_baz
    assert helper.fault_injected<span class="o">()</span> and response.status_code in <span class="o">[</span><span class="m">503</span>, <span class="m">404</span><span class="o">]</span>
AssertionError
</pre></div>
</div>
</section>
<section id="fixing-the-bug">
<h2>Fixing the Bug<a class="headerlink" href="#fixing-the-bug" title="Permalink to this headline"></a></h2>
<p>Clearly there is a bug! To fix the bug, we see that a Connection Error caused a failed assertion. We forgot to handle the case where <code class="docutils literal notranslate"><span class="pre">foo</span></code>’s request to <code class="docutils literal notranslate"><span class="pre">bar</span></code> fails due to a <code class="docutils literal notranslate"><span class="pre">ConnectionError</span></code>. In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/service/foo/foo/app.py</span></code>’s <code class="docutils literal notranslate"><span class="pre">foo</span></code> method, add the following code right after <code class="docutils literal notranslate"><span class="pre">foo</span></code> handles the timeout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="s2">&quot;The bar service is unavailable.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing-the-fix">
<h2>Testing the Fix<a class="headerlink" href="#testing-the-fix" title="Permalink to this headline"></a></h2>
<p>Now, verify that the bug is fixed. Rerun just the specific bug we found using (note the <code class="docutils literal notranslate"><span class="pre">RUN_COUNTEREXAMPLE</span></code> flag which allows us to rerun just the failed test):</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">RUN_COUNTEREXAMPLE=true</span> <span class="pre">make</span> <span class="pre">local-functional-with-fault-injection</span></code></p>
<p>The previously failed test should pass:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>NOTICE<span class="o">]</span>: Completed testing test_functional_foo_bar_baz
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually ran:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually pruned:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: None.
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of tests attempted: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of <span class="nb">test</span> executions ran: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions pruned with only dynamic pruning: <span class="m">0</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Total tests: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Time elapsed: <span class="m">2</span>.2366678714752197 seconds.
</pre></div>
</div>
<p>Lastly, run all of the <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> tests again to verify fault tolerance:</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">make</span> <span class="pre">local-functional-with-fault-injection-bypass-start-stop</span></code></p>
<p>Now, all tests should pass! There should be a total of 8 tests generated by <code class="docutils literal notranslate"><span class="pre">filibuster</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>NOTICE<span class="o">]</span>: Completed testing test_functional_foo_bar_baz
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually ran:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5002/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]</span>, <span class="o">[</span><span class="s2">&quot;19341e59858927e30ff947bd62841716&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;bar&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: None.
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">2</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5002/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]</span>, <span class="o">[</span><span class="s2">&quot;19341e59858927e30ff947bd62841716&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;bar&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with metadata: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">500</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">500</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">3</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5002/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]</span>, <span class="o">[</span><span class="s2">&quot;19341e59858927e30ff947bd62841716&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;bar&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.Timeout&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.Timeout&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">4</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5002/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]</span>, <span class="o">[</span><span class="s2">&quot;19341e59858927e30ff947bd62841716&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;bar&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">1</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">5</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with metadata: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">500</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">500</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">6</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.Timeout&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.Timeout&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">7</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with exception: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;requests.exceptions.ConnectionError&#39;</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions actually pruned:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test number: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: args: <span class="o">[</span><span class="s1">&#39;http://0.0.0.0:5001/bar/baz&#39;</span><span class="o">]</span> kwargs: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   execution_index: <span class="o">[[</span><span class="s2">&quot;82c72a199994ec4617027843481fafce&quot;</span>, <span class="m">1</span><span class="o">]]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   origin_vclock: <span class="o">{}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:   vclock: <span class="o">{</span><span class="s1">&#39;foo&#39;</span>: <span class="m">1</span><span class="o">}</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: * Failed with metadata: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">503</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Failures <span class="k">for</span> this execution:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="m">0</span>: <span class="o">[(</span><span class="s1">&#39;return_value&#39;</span>, <span class="o">{</span><span class="s1">&#39;status_code&#39;</span>: <span class="m">503</span><span class="o">})]</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: <span class="o">=====================================================================================</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of tests attempted: <span class="m">7</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Number of <span class="nb">test</span> executions ran: <span class="m">7</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Test executions pruned with only dynamic pruning: <span class="m">1</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Total tests: <span class="m">8</span>
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>:
<span class="o">[</span>FILIBUSTER<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span>: Time elapsed: <span class="m">1</span>.0523009300231934 seconds.
</pre></div>
</div>
</section>
<section id="integrating-docker">
<h2>Integrating Docker<a class="headerlink" href="#integrating-docker" title="Permalink to this headline"></a></h2>
<p>Once your application runs with <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> locally, by adding just a few files you can make run your application using Docker. Add and populate some of the files:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>touch filibuster-tutorial/docker-compose.yaml
<span class="nv">reqs</span><span class="o">=</span><span class="s2">&quot;Flask==1.0.0\npytest\nrequests\nopentelemetry-sdk==1.0.0rc1\nopentelemetry-api==1.0.0rc1\nopentelemetry-instrumentation==0.18b0\nopentelemetry-exporter-jaeger==1.0.0rc1\nopentelemetry-instrumentation-flask==0.18b1\nopentelemetry-instrumentation-requests==0.18b1\ndocker\nkubernetes&quot;</span>
<span class="nb">echo</span> -e <span class="nv">$reqs</span> &gt;&gt; filibuster-tutorial/base_requirements.txt
<span class="k">for</span> service in foo bar baz
<span class="k">do</span>
    <span class="c1"># Each service must have a Dockerfile.</span>
    <span class="nv">dockerfile</span><span class="o">=</span><span class="s2">&quot;FROM filibuster-tutorial:configuration\n\nWORKDIR /nufilibuster/examples/filibuster-tutorial/services/</span><span class="nv">$service</span><span class="s2">\n\nCOPY . /nufilibuster/examples/filibuster-tutorial/services/</span><span class="nv">$service</span><span class="s2">\n\nENTRYPOINT [ \&quot;python3\&quot; ]\nCMD [ \&quot;-m\&quot;, \&quot;</span><span class="nv">$service</span><span class="s2">.app\&quot; ] &quot;</span>
    <span class="nb">echo</span> -e <span class="nv">$dockerfile</span> &gt;&gt; filibuster-tutorial/services/<span class="nv">$service</span>/Dockerfile
<span class="k">done</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">filibuster-tutorial/docker-compose.yaml</span></code> add:</p>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span>version: <span class="s1">&#39;3&#39;</span>

services:
    foo:
        image: <span class="si">${</span><span class="nv">AWS_ACCOUNT_ID</span><span class="si">}</span>.dkr.ecr.<span class="si">${</span><span class="nv">REGION</span><span class="si">}</span>.amazonaws.com/filibuster-tutorial:foo
        build:
            context: <span class="s1">&#39;./services/foo/&#39;</span>
            dockerfile: <span class="s1">&#39;./Dockerfile&#39;</span>
        ports:
            - <span class="s2">&quot;5000:5000&quot;</span>
    bar:
        image: <span class="si">${</span><span class="nv">AWS_ACCOUNT_ID</span><span class="si">}</span>.dkr.ecr.<span class="si">${</span><span class="nv">REGION</span><span class="si">}</span>.amazonaws.com/filibuster-tutorial:bar
        build:
            context: <span class="s1">&#39;./services/bar&#39;</span>
            dockerfile: <span class="s1">&#39;./Dockerfile&#39;</span>
        ports:
            - <span class="s2">&quot;5001:5001&quot;</span>
    baz:
        image: <span class="si">${</span><span class="nv">AWS_ACCOUNT_ID</span><span class="si">}</span>.dkr.ecr.<span class="si">${</span><span class="nv">REGION</span><span class="si">}</span>.amazonaws.com/filibuster-tutorial:baz
        build:
            context: <span class="s1">&#39;./services/baz&#39;</span>
            dockerfile: <span class="s1">&#39;./Dockerfile&#39;</span>
        ports:
            - <span class="s2">&quot;5002:5002&quot;</span>
</pre></div>
</div>
<p>Now you can run things using Docker. Try running <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">make</span> <span class="pre">docker-functional-with-fault-injection-bypass-start-stop</span></code>.</p>
</section>
<section id="integrating-minikube">
<h2>Integrating Minikube<a class="headerlink" href="#integrating-minikube" title="Permalink to this headline"></a></h2>
<p>Finally, once your application runs with <code class="docutils literal notranslate"><span class="pre">filibuster</span></code> using docker, you can easily make it run using Minikube. Define service and deployment files as follows for each of the services:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note the services and corresponding ports correspond to filibuster-tutorial/networking.json</span>
<span class="k">for</span> i in <span class="s2">&quot;foo 5000&quot;</span> <span class="s2">&quot;bar 5001&quot;</span> <span class="s2">&quot;baz 5002&quot;</span>
<span class="k">do</span>
    <span class="nb">set</span> -- <span class="nv">$i</span>
    <span class="nv">service</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">port</span><span class="o">=</span><span class="nv">$2</span>

    <span class="nv">serviceyaml</span><span class="o">=</span><span class="s2">&quot;apiVersion: v1\nkind: Service\nmetadata:\n  name: </span><span class="nv">$service</span><span class="s2">\nspec:\n  type: NodePort\n  ports:\n    - name: \&quot;</span><span class="nv">$port</span><span class="s2">\&quot;\n      port: </span><span class="nv">$port</span><span class="s2">\n      targetPort: </span><span class="nv">$port</span><span class="s2">\n  selector:\n    io.kompose.service: </span><span class="nv">$service</span><span class="s2">\n&quot;</span>
    <span class="nv">deploymentyaml</span><span class="o">=</span><span class="s2">&quot;apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    io.kompose.service: </span><span class="nv">$service</span><span class="s2">\n  name: </span><span class="nv">$service</span><span class="s2">\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      io.kompose.service: </span><span class="nv">$service</span><span class="s2">\n  template:\n    metadata:\n      labels:\n        io.kompose.service: </span><span class="nv">$service</span><span class="s2">\n    spec:\n      containers:\n        - image: \${AWS_ACCOUNT_ID}.dkr.ecr.\${REGION}.amazonaws.com/filibuster-tutorial:</span><span class="nv">$service</span><span class="s2">\n          name: </span><span class="nv">$service</span><span class="s2">\n          ports:\n          - containerPort: </span><span class="nv">$port</span><span class="s2">\n          imagePullPolicy: IfNotPresent\n      restartPolicy: Always\n      imagePullSecrets:\n        - name: regcred&quot;</span>

    mkdir filibuster-tutorial/services/<span class="nv">$service</span>/k8s
    <span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$serviceyaml</span><span class="s2">&quot;</span> &gt;&gt; filibuster-tutorial/services/<span class="nv">$service</span>/k8s/service.yaml
    <span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$deploymentyaml</span><span class="s2">&quot;</span> &gt;&gt; filibuster-tutorial/services/<span class="nv">$service</span>/k8s/deployment.yaml
<span class="k">done</span>
<span class="nv">env</span><span class="o">=</span><span class="s2">&quot;example=filibuster-tutorial\nservices=\&quot;foo bar baz\&quot;&quot;</span>
<span class="nb">echo</span> -e <span class="nv">$env</span> &gt;&gt; filibuster-tutorial/env.txt
</pre></div>
</div>
<p>Now you can run things using Minikube. Try running <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">filibuster-tutorial;</span> <span class="pre">make</span> <span class="pre">minikube-functional-with-fault-injection-bypass-start-stop</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Filibuster" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Christopher S. Meiklejohn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
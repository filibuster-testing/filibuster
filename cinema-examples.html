<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cinema Examples &mdash; filibuster  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Industry Examples" href="industry-examples.html" />
    <link rel="prev" title="Running" href="running.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> filibuster
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using Filibuster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Filibuster Corpus</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cinema Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cinema-1-basic-cinema-example"><code class="docutils literal notranslate"><span class="pre">cinema-1</span></code>: Basic Cinema Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fault-analysis">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filibuster-analysis">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-2-nesting-service-calls"><code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>: Nesting Service Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-3-adding-retry-loops"><code class="docutils literal notranslate"><span class="pre">cinema-3</span></code>: Adding Retry Loops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-4-calls-to-3rd-party-services"><code class="docutils literal notranslate"><span class="pre">cinema-4</span></code>: Calls To 3rd Party Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Filibuster Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#no-reduction">No Reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-reduction">Dynamic Reduction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-5-default-responses"><code class="docutils literal notranslate"><span class="pre">cinema-5</span></code>: Default Responses</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-6-fallbacks"><code class="docutils literal notranslate"><span class="pre">cinema-6</span></code>: Fallbacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-7-health-checks"><code class="docutils literal notranslate"><span class="pre">cinema-7</span></code>: Health Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Filibuster Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cinema-8-monolithic"><code class="docutils literal notranslate"><span class="pre">cinema-8</span></code>: Monolithic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Fault Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Filibuster Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="industry-examples.html">Industry Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Filibuster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-overview.html">Instrumentation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-flask.html">Instrumentation Example: Flask</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-requests.html">Instrumentation Example: Requests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Instrumentation: GRPC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-overview.html">Instrumenting GRPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client.html">Instrumenting Remote Service Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-server.html">Instrumenting Services To Receive Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client-fi.html">Enabling Fault-Injection in the Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-grpc-client-analysis.html">Static Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Filibuster Server API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-formats.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-create.html">HTTP API: Create</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-update.html">HTTP API: Update</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation-server-new-test-execution.html">HTTP API: New Test Execution</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">filibuster</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Cinema Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cinema-examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cinema-examples">
<h1>Cinema Examples<a class="headerlink" href="#cinema-examples" title="Permalink to this headline">ÔÉÅ</a></h1>
<section id="cinema-1-basic-cinema-example">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-1</span></code>: Basic Cinema Example<a class="headerlink" href="#cinema-1-basic-cinema-example" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>The first example, which we are calling <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code>, comes from <a class="reference external" href="https://codeahoy.com/2016/07/10/writing-microservices-in-python-using-flask/">a tutorial on building
microservices in Flask</a>.
The <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code> example contains 4 services: <code class="docutils literal notranslate"><span class="pre">bookings</span></code>, <code class="docutils literal notranslate"><span class="pre">movies</span></code>, <code class="docutils literal notranslate"><span class="pre">showtimes</span></code>, and <code class="docutils literal notranslate"><span class="pre">users</span></code>,
where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bookings</span></code>: contains information about bookings for each client;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">movies</span></code>: contains detailed information about each movie;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showtimes</span></code>: contains information about shows for each date; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">users</span></code>: that aggregates information about movies that a particular user has bookings for.</p></li>
</ul>
<img alt="_images/cinema-1.jpg" src="_images/cinema-1.jpg" />
</section>
<section id="fault-analysis">
<h3>Fault Analysis<a class="headerlink" href="#fault-analysis" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code>, the most interesting service to consider is the <code class="docutils literal notranslate"><span class="pre">users</span></code> service, as it
has a dependency on both the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> and <code class="docutils literal notranslate"><span class="pre">movies</span></code> services operating correctly. For users
to retrieve a user‚Äôs bookings information, it first retrieves information from the <code class="docutils literal notranslate"><span class="pre">bookings</span></code>
service and then retrieves information from the <code class="docutils literal notranslate"><span class="pre">movies</span></code> service based on the information
retrieved from the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> service. If no information can be retrieved from the <code class="docutils literal notranslate"><span class="pre">bookings</span></code>
service (the user doesn‚Äôt have any movie bookings or that the call failed/timed out/errored),
no call is made to the <code class="docutils literal notranslate"><span class="pre">movies</span></code> service. This is a simple example of one service calling multiple
services in a sequence. There is a dependency among the calls: if one call fails, any subsequent
calls will not be issued.</p>
</section>
<section id="filibuster-analysis">
<h3>Filibuster Analysis<a class="headerlink" href="#filibuster-analysis" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this pattern, let <span class="math notranslate nohighlight">\(k_i\)</span> be the number of different ways that the <cite>i</cite>-th service can fail,
and let <span class="math notranslate nohighlight">\(n\)</span> be the total number of calls made. Using this, the number of tests that Filibuster
should execute should be: <span class="math notranslate nohighlight">\(k_1 + k_2 + ... + k_n\)</span>.</p>
<p>As <code class="docutils literal notranslate"><span class="pre">bookings</span></code> can fail 5 ways, and <code class="docutils literal notranslate"><span class="pre">movies</span></code> can fail 4 ways, the number of tests we expect is
<span class="math notranslate nohighlight">\(1 + 5 + 4 = 10\)</span>. This is the exact number executed by Filibuster.</p>
</section>
</section>
<section id="cinema-2-nesting-service-calls">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>: Nesting Service Calls<a class="headerlink" href="#cinema-2-nesting-service-calls" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id1">
<h3>Description<a class="headerlink" href="#id1" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code> is reorganized so that <code class="docutils literal notranslate"><span class="pre">users</span></code> first calls <code class="docutils literal notranslate"><span class="pre">bookings</span></code> and then
<code class="docutils literal notranslate"><span class="pre">bookings</span></code> calls <code class="docutils literal notranslate"><span class="pre">movies</span></code>.</p>
<img alt="_images/cinema-2.jpg" src="_images/cinema-2.jpg" />
</section>
<section id="id2">
<h3>Fault Analysis<a class="headerlink" href="#id2" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is an example of a chain of calls. The first call triggers the second call and results are
forwarded back.</p>
</section>
<section id="id3">
<h3>Filibuster Analysis<a class="headerlink" href="#id3" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this pattern, let <span class="math notranslate nohighlight">\(n\)</span> be the number of edges (calls) in the chain, and let <span class="math notranslate nohighlight">\(k_i\)</span> be the number
of different ways that the <span class="math notranslate nohighlight">\(i\)</span>-th service can fail. This means that the number of tests executed
by Filibuster should be <span class="math notranslate nohighlight">\(k_1 + k_2 + ... + k_n\)</span>. As <code class="docutils literal notranslate"><span class="pre">bookings</span></code> can fail 5 ways, and <code class="docutils literal notranslate"><span class="pre">movies</span></code> can
fail 4 ways, we should execute <span class="math notranslate nohighlight">\(1 + 4 + 5 = 10\)</span> tests, the exact number executed by Filibuster
(without dynamic reduction.)</p>
<p>However, we‚Äôre able to avoid one execution through dynamic reduction. To understand why, we provide
the following reasoning.</p>
<p>By injecting a <code class="docutils literal notranslate"><span class="pre">Timeout</span></code> or <code class="docutils literal notranslate"><span class="pre">ConnectionError</span></code> exception for the call from the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> service
to the <code class="docutils literal notranslate"><span class="pre">movies</span></code> service, we cause the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> service to return a <code class="docutils literal notranslate"><span class="pre">503</span> <span class="pre">Service</span> <span class="pre">Unavailable</span></code>
response back to the <code class="docutils literal notranslate"><span class="pre">users</span></code> service. Therefore, since we have already seen the effect on the 503 error
at the <code class="docutils literal notranslate"><span class="pre">users</span></code> service, when returned from the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> service, we do not need to directly inject
the 503 error, eliminating one possible test. With dynamic reduction enabled, we see this effect with
the Filibuster output: <span class="math notranslate nohighlight">\(1 + 3 + 5 = 9\)</span> tests.</p>
</section>
</section>
<section id="cinema-3-adding-retry-loops">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-3</span></code>: Adding Retry Loops<a class="headerlink" href="#cinema-3-adding-retry-loops" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id4">
<h3>Description<a class="headerlink" href="#id4" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, based on <code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>, we move the call made from the <code class="docutils literal notranslate"><span class="pre">users</span></code> service to the
<code class="docutils literal notranslate"><span class="pre">bookings</span></code> service into a retry loop (with a single retry.)</p>
<img alt="_images/cinema-3.jpg" src="_images/cinema-3.jpg" />
</section>
<section id="id5">
<h3>Fault Analysis<a class="headerlink" href="#id5" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is an example of a retry loop.</p>
</section>
<section id="id6">
<h3>Filibuster Analysis<a class="headerlink" href="#id6" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Similar to previous examples, <code class="docutils literal notranslate"><span class="pre">bookings</span></code> can fail 5 ways, and <code class="docutils literal notranslate"><span class="pre">movies</span></code> can fail 4 ways.
However, now that the call from <code class="docutils literal notranslate"><span class="pre">users</span></code> to <code class="docutils literal notranslate"><span class="pre">bookings</span></code> has been placed in a loop, we have to
consider those calls failing multiple times. Therefore, we should consider the following:</p>
<ul class="simple">
<li><p>first, we know that without a retry loop (<code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>) we need to test 10 executions (10):</p></li>
<li><p>next, we have to additionally consider the first iteration of the loop failing (9); and</p></li>
<li><p>we have to also consider all possible outcomes of the second iteration of the loop (1 success, 9 failures = 10).</p></li>
</ul>
<p>This results in <span class="math notranslate nohighlight">\((1 + 9 + (9 \times 10)) = 91\)</span>, the number of tests executed by Filibuster (without
dynamic reduction.)</p>
<p>We can use the same reasoning as we used in <code class="docutils literal notranslate"><span class="pre">cinema-2</span></code> to identify how many tests will be
reduced: we don‚Äôt need to inject faults on services directly when that failure is previously
generated by injecting faults on one or more of its dependencies.</p>
<p>Therefore, we consider the following the minimum number of test executions that are required to
cover the entire fault space:</p>
<ul class="simple">
<li><p>the passing execution (1); and</p></li>
<li><p>exhaustion of the first loop (5 outcomes: 3 status codes, 2 exceptions) where the second loop succeeds (5); and</p></li>
<li><p>exhaustion of the first loop (5 outcomes: 3 status codes, 2 exceptions) with exhaustion of the second loop (6 outcomes: 3 status codes, 2 exceptions, 1 success) (6); and</p></li>
<li><p>combinations of all possible outcomes of the movies service: (4 errors, 1 success = <span class="math notranslate nohighlight">\(5 \times 5 = 25\)</span>).</p></li>
</ul>
<p>This results in: <span class="math notranslate nohighlight">\(1 + 5 + 6 + 25 = 37\)</span> tests. This is precisely the number of tests Filibuster
executes with dynamic reduction.</p>
</section>
</section>
<section id="cinema-4-calls-to-3rd-party-services">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-4</span></code>: Calls To 3rd Party Services<a class="headerlink" href="#cinema-4-calls-to-3rd-party-services" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, based on <code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>, each service calls to a remote service before calling a
dependent service. Each of these calls made to remote services can fail without affecting the
response. Specifically:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">users</span></code> retrieves information from IMDB;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bookings</span></code> retrieves information from Fandango; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">movies</span></code> retrieves information from Rotten Tomatoes.</p></li>
</ul>
<img alt="_images/cinema-4.jpg" src="_images/cinema-4.jpg" />
</section>
<section id="id8">
<h3>Fault Analysis<a class="headerlink" href="#id8" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is not a canonical example of any particular pattern, but a composition of the first two patterns:
the sequence and chain. More specifically, this example contains a chain of sequences of calls:</p>
<ul class="simple">
<li><dl class="simple">
<dt>users -&gt;</dt><dd><ul>
<li><p>IMDB</p></li>
<li><dl class="simple">
<dt>bookings -&gt;</dt><dd><ul>
<li><p>Fandango</p></li>
<li><dl class="simple">
<dt>movies -&gt;</dt><dd><ul>
<li><p>Rotten Tomatoes</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>In this particular example, none of the calls to remote services impact the chain; however, a failure
of any non-remote services cause the chain to abort immediately, as seen in <code class="docutils literal notranslate"><span class="pre">cinema-2</span></code>.</p>
</section>
<section id="id9">
<h3>Filibuster Analysis<a class="headerlink" href="#id9" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In order to understand what tests Filibuster needs to execute for this example, we can start by building
upon the formula we had for chains of calls.</p>
<section id="no-reduction">
<h4>No Reduction<a class="headerlink" href="#no-reduction" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>We start by knowing that <code class="docutils literal notranslate"><span class="pre">bookings</span></code> is called from <code class="docutils literal notranslate"><span class="pre">users</span></code> and can fail 5 ways; we also know that
<code class="docutils literal notranslate"><span class="pre">movies</span></code> is called by <code class="docutils literal notranslate"><span class="pre">bookings</span></code> and can fail 4 ways. Therefore, we know that we should start off
with the following: <span class="math notranslate nohighlight">\(1 + 5 + 4 = 10\)</span>. However, this doesn‚Äôt account for the remote calls.
Therefore, we have to consider what impact having sequences in each service makes on this formula.</p>
<p><strong>IMDB</strong></p>
<p>Let‚Äôs consider first IMDB. We know that the call to IMDB will always happen, and it‚Äôs outcome will not
impact whether we make the call to <code class="docutils literal notranslate"><span class="pre">bookings</span></code> from the <code class="docutils literal notranslate"><span class="pre">users</span></code> service. Since IMDB has two possible
outcomes (failure with <code class="docutils literal notranslate"><span class="pre">ConnectionError</span></code> or success), this alters our formula:</p>
<div class="math notranslate nohighlight">
\[1 + (2 \times 5) + 4\]</div>
<p>We put the 2 before the 5 in the multiplication to indicate that the call to IMDB occurs before the
call to <cite>bookings</cite>: this is done to help the reader.</p>
<p>However, we also need to consider that we will try the combination of all possible outcomes of the
call to IMDB with the ways that the <cite>movies</cite> service can fail. Again, this alters the formula:</p>
<div class="math notranslate nohighlight">
\[1 + (2 \times 5) + (4 \times (2))\]</div>
<p>We put the 2 in parentheses after the 4 in the multiplication to indicate that we are referencing
combinations with an earlier failure. Again, this is done to help the reader.</p>
<p>Finally, we have to consider the failure of IMDB in isolation. We can alter the formula further:</p>
<div class="math notranslate nohighlight">
\[1 + (2 \times 5) + (4 \times (2)) + 1 = 20\]</div>
<p>We can rewrite this clearer with the following form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;passing\ + \\
&amp;(imdb_{outcomes}\ \times\ bookings_{failures})\ + \\
&amp;(movies_{failures}\ \times\ imdb_{outcomes})\ + \\
&amp;imdb_{failure\ only} \\
&amp;=\ 20\end{split}\]</div>
<p><strong>Fandango</strong></p>
<p>When we consider the call that <code class="docutils literal notranslate"><span class="pre">bookings</span></code> makes to Fandango, we have to follow the same process.</p>
<p>First, we need to consider the Fandango outcomes, as they do not impact if any subsequent calls were
made. This adjusts the formula by adding the Fandango failures to the combinations we try with IMDB and
movie failures.</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;passing\ + \\
&amp;(imdb_{outcomes}\ \times\ bookings_{failures})\ + \\
&amp;(imdb_{outcomes}\ \times\ movies_{failures}\ \times\ fandango_{failures})\ +\ \\
&amp;imdb_{failure\ only} \\\end{split}\]</div>
<p>Similarly, we have to account for both Fandango failing alone and Fandango failing with IMDB with two adjustments:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;passing\ + \\
&amp;(imdb_{outcomes}\ \times\ bookings_{failures})\ + \\
&amp;(imdb_{outcomes}\ \times\ movies_{failures}\ \times\ fandango_{outcomes})\ +\ \\
&amp;imdb_{failure\ only}\ +\ \\
&amp;fandango_{failure\ only}\ +\ \\
&amp;(imdb_{failure\ only}\ \times\ fandango_{failure\ only}) \\
&amp;=\ 30\end{split}\]</div>
<p><strong>Rotten Tomatoes</strong></p>
<p>Finally, we have to follow the same process for the call from <cite>movies</cite> to Rotten Tomatoes. First, consider it
in combination with other calls from <cite>movies</cite> ‚Äì this happens to be none ‚Äì and then it‚Äôs combination with all
the other remote service calls.</p>
<p>This yields the final adjustment:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;passing\ + \\
&amp;(imdb_{outcomes}\ \times\ bookings_{failures})\ + \\
&amp;(imdb_{outcomes}\ \times\ movies_{failures}\ \times\ fandango_{outcomes})\ + \\
&amp;imdb_{failure\ only}\ + \\
&amp;fandango_{failure\ only}\ + \\
&amp;rotten\ tomatoes_{failure\ only}\ + \\
&amp;(imdb_{failure\ only}\ \times\ fandango_{failure\ only})\ + \\
&amp;(imdb_{failure\ only}\ \times\ rotten\ tomatoes_{failure\ only})\ + \\
&amp;(fandango_{failure\ only}\ \times\ rotten\ tomatoes_{failure\ only})\ + \\
&amp;(imdb_{failure\ only}\ \times\ fandango_{failure\ only}\ \times\ rotten\ tomatoes_{failure\ only}) \\
&amp;=\ 34\end{split}\]</div>
<p>This is the exact number of tests executed by Filibuster (without dynamic pruning.)</p>
</section>
<section id="dynamic-reduction">
<h4>Dynamic Reduction<a class="headerlink" href="#dynamic-reduction" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>With dynamic reduction, we have to consider fewer cases.</p>
<p>We consider the following, presenting them in order of execution, which matches the postorder execution
of the application through concolic execution:</p>
<ul class="simple">
<li><p>the passing execution (1);</p></li>
<li><p>the ways that Rotten Tomatoes can fail (1);</p></li>
<li><p>the ways that movies can fail (4);</p></li>
<li><p>the ways Fandango can fail combined with the possible failures of movies: <span class="math notranslate nohighlight">\((1 + (4 \times 1) = 5)\)</span>;</p></li>
<li><p>the ways that bookings can fail (4); and</p></li>
<li><p>the ways that bookings can fail (5) combined with the possible failures of IMDB: <span class="math notranslate nohighlight">\((1 + (5 \times 1)) = 6\)</span>.</p></li>
</ul>
<p>This results in: <span class="math notranslate nohighlight">\(1 + 1 + 4 + (1 + (4 \times 1)) + 4 + (1 + (5 \times 1)) = 21\)</span> tests. This is the number
that Filibuster runs with dynamic reduction.</p>
</section>
</section>
</section>
<section id="cinema-5-default-responses">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-5</span></code>: Default Responses<a class="headerlink" href="#cinema-5-default-responses" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id10">
<h3>Description<a class="headerlink" href="#id10" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, based on <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code>, all calls happen regardless of failure. In the event of failure,
a default response is used.</p>
<img alt="_images/cinema-5.jpg" src="_images/cinema-5.jpg" />
</section>
<section id="id11">
<h3>Fault Analysis<a class="headerlink" href="#id11" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is a simple example of one service calling multiple services without dependencies. All requests
will always be made regardless of failure of previous requests.</p>
</section>
<section id="id12">
<h3>Filibuster Analysis<a class="headerlink" href="#id12" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this pattern, let <span class="math notranslate nohighlight">\(k_i\)</span> be the number of different ways that the <span class="math notranslate nohighlight">\(i\)</span>-th service can fail,
and let <span class="math notranslate nohighlight">\(n\)</span> be the total number of requests made. Then the number of fault-injection tests should be
<span class="math notranslate nohighlight">\((1+k_1) * (1+k_2) * ... * (1+k_n)\)</span>.</p>
<p>Since each request has 4 possible failures, in this case the number of tests executed by Filibuster
should be <span class="math notranslate nohighlight">\(5 \times 5 = 25\)</span>. This is the exact number executed by Filibuster.</p>
</section>
</section>
<section id="cinema-6-fallbacks">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-6</span></code>: Fallbacks<a class="headerlink" href="#cinema-6-fallbacks" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id13">
<h3>Description<a class="headerlink" href="#id13" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This example is based on <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code> and adds a backup service for the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> service:
<code class="docutils literal notranslate"><span class="pre">bookings-primary</span></code>, replaces <code class="docutils literal notranslate"><span class="pre">bookings</span></code>, and <code class="docutils literal notranslate"><span class="pre">bookings-secondary</span></code> is the backup. The request to
retrieve the <code class="docutils literal notranslate"><span class="pre">bookings</span></code> for a user will issue a request to the <code class="docutils literal notranslate"><span class="pre">bookings-secondary</span></code> service if the
<code class="docutils literal notranslate"><span class="pre">bookings-primary</span></code> service has failed or returns an error. It‚Äôs important to note that the two bookings
services return different responses when requests are made for the same user: this is an instance of
eventual consistency between replicas.</p>
<img alt="_images/cinema-6.jpg" src="_images/cinema-6.jpg" />
</section>
<section id="id14">
<h3>Fault Analysis<a class="headerlink" href="#id14" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This illustrates a fallback pattern which is common in microservice architectures.</p>
</section>
<section id="id15">
<h3>Filibuster Analysis<a class="headerlink" href="#id15" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This particular example extends <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code> and is a combination of two patterns: the fallback and
sequence patterns. To determine how this can fail, let us first look at the two bookings service.
According to the formula above, there are <span class="math notranslate nohighlight">\(1 + 4 \times 5 = 21\)</span> paths, out of which
<span class="math notranslate nohighlight">\(4 \times 4 = 16\)</span> end up with an error and 5 end up with a response. In the first 16 paths,
we don‚Äôt make the call to <code class="docutils literal notranslate"><span class="pre">movies</span></code>. We then consider the combinations of the second case (5 paths)
with <code class="docutils literal notranslate"><span class="pre">movies</span></code> success/failing (5 ways), which yields <span class="math notranslate nohighlight">\(5 \times 5 = 25\)</span>. So the total is <span class="math notranslate nohighlight">\(25 + 16 = 41\)</span>.
This is the exact number executed by Filibuster.</p>
</section>
</section>
<section id="cinema-7-health-checks">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-7</span></code>: Health Checks<a class="headerlink" href="#cinema-7-health-checks" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id16">
<h3>Description<a class="headerlink" href="#id16" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, based on <code class="docutils literal notranslate"><span class="pre">cinema-6</span></code>, we first check that the health check service of the primary
bookings replica passes before trying to access it.</p>
<img alt="_images/cinema-7.jpg" src="_images/cinema-7.jpg" />
</section>
<section id="id17">
<h3>Fault Analysis<a class="headerlink" href="#id17" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is a pattern where, depending on the result of a previous request, a later request goes to different
services.</p>
</section>
<section id="id18">
<h3>Filibuster Analysis<a class="headerlink" href="#id18" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this case, we run the same number of tests as we do in <code class="docutils literal notranslate"><span class="pre">cinema-6</span></code>; however, we also run 4 additional
tests to account for the 4 different failures that are possible for the health check service.</p>
<p>Therefore, <span class="math notranslate nohighlight">\(num\ tests_cinema-6 + 4 = 41 + 4 = 45\)</span>. This is the exact number executed by Filibuster.</p>
</section>
</section>
<section id="cinema-8-monolithic">
<h2><code class="docutils literal notranslate"><span class="pre">cinema-8</span></code>: Monolithic<a class="headerlink" href="#cinema-8-monolithic" title="Permalink to this headline">ÔÉÅ</a></h2>
<section id="id19">
<h3>Description<a class="headerlink" href="#id19" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">cinema-1</span></code> example is collapsed into a monolith with an API server making
requests to it using a retry loop, where after the initial request, there is a single retry.</p>
<img alt="_images/cinema-8.jpg" src="_images/cinema-8.jpg" />
</section>
<section id="id20">
<h3>Fault Analysis<a class="headerlink" href="#id20" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>This is a bare-bones example of a bounded retry loop.</p>
</section>
<section id="id21">
<h3>Filibuster Analysis<a class="headerlink" href="#id21" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Since there are 5 possible outcomes (4 failures for the monolith and 1 success case) and the
second request is only executed if the first fails, we have <span class="math notranslate nohighlight">\((1 + (4 \times 5)) = 21\)</span>, which represents
the first passing and the first failing with all possible outcomes of the second. This is the exact
number executed by Filibuster.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="running.html" class="btn btn-neutral float-left" title="Running" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="industry-examples.html" class="btn btn-neutral float-right" title="Industry Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Christopher S. Meiklejohn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>